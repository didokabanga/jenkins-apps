pipeline {

  agent any

  environment {
    PATH = "/opt/maven/bin:$PATH"
    MAVEN_HOME = tool name: 'MY_MAVEN3', type: 'maven'
  }

  stages {

    stage("Git Checkout"){
      steps{
          git branch: 'main', url: 'https://github.com/didokabanga/jenkins-apps.git'
      }
    }

    stage("Maven Build"){
      steps{
          echo "PATH is: $PATH"
           dir('jenkins-webapp01/') {
              // some block
              sh "mvn clean package"
              sh "mv target/*.war target/myweb01.war"
           }
      }
    } // stage
    
    stage("deploy-dev"){
      steps{ 
            sshagent(['tomcat-cred']) {
            sh """ 
          
            scp -o StrictHostKeyChecking=no jenkins-webapp01/target/myweb01.war root@192.168.70.23:/dslib
            ssh -o StrictHostKeyChecking=no root@192.168.70.23 'cp -r /dslib//myweb01.war /opt/tomcat/webapps/' 
           
            """
            } 

      }
    }//stage

  }//stages

}//pipeline
